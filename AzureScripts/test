# trigger:
#   batch: true
#   branches:
#     include:
#       - main

# variables:
#   - group: PipelineVariables

# stages:
#   - stage: windows_android_stage
#     displayName: Windows and Android stages
#     pool:
#       vmImage: windows-latest

#     jobs:
#       - job: windows_job
#         displayName: Windows job
#         steps:
#           - task: DownloadSecureFile@1
#             name: ssh_key
#             displayName: Download SSH Private Key
#             inputs:
#               secureFile: 'azure_devops_id_ed25519'  # Your uploaded SSH key

#           - task: Bash@3
#             displayName: Clone repo from local server
#             inputs:
#               targetType: 'inline'
#               script: |
#                 mkdir -p ~/.ssh
#                 cp $(ssh_key.secureFilePath) ~/.ssh/id_ed25519
#                 chmod 600 ~/.ssh/id_ed25519
#                 ssh-keyscan yourserver.com >> ~/.ssh/known_hosts
#                 git clone ssh://user@yourserver.com:/path/to/repo.git MAUITestApp

#           - template: setup_template.yml

#           - task: Bash@3
#             displayName: Build Windows MAUI app
#             inputs:
#               targetType: 'inline'
#               script: |
#                 dotnet publish MAUITestApp/MAUITestApp.csproj \
#                   -f net9.0-windows10.0.19041.0 \
#                   -c Release \
#                   --output '$(Build.ArtifactStagingDirectory)/Windows'

#           - task: PublishBuildArtifacts@1
#             displayName: Publish Windows app to artifacts
#             inputs:
#               PathtoPublish: '$(Build.ArtifactStagingDirectory)/Windows'
#               ArtifactName: 'Windows'

#       - job: android_job
#         dependsOn:
#           - windows_job
#         displayName: Android job
#         pool:
#           vmImage: windows-latest
#         steps:
#           - task: DownloadSecureFile@1
#             name: ssh_key
#             displayName: Download SSH Private Key
#             inputs:
#               secureFile: 'azure_devops_id_ed25519'  # Your uploaded SSH key

#           - task: Bash@3
#             displayName: Clone repo from local server
#             inputs:
#               targetType: 'inline'
#               script: |
#                 mkdir -p ~/.ssh
#                 cp $(ssh_key.secureFilePath) ~/.ssh/id_ed25519
#                 chmod 600 ~/.ssh/id_ed25519
#                 ssh-keyscan yourserver.com >> ~/.ssh/known_hosts
#                 git clone ssh://user@yourserver.com:/path/to/repo.git MAUITestApp

#           - template: setup_template.yml

#           - task: DownloadSecureFile@1
#             name: keystore_file
#             displayName: Download Keystore File
#             inputs:
#               secureFile: 'myapp.keystore'

#           - task: CopyFiles@2
#             name: copy_keystore_file
#             displayName: Import Secure File
#             inputs:
#               SourceFolder: '$(Agent.TempDirectory)'
#               Contents: 'myapp.keystore'
#               TargetFolder: 'MAUITestApp'

#           - task: Bash@3
#             displayName: Build Android MAUI app
#             inputs:
#               targetType: 'inline'
#               script: |
#                 dotnet publish MAUITestApp/MAUITestApp.csproj \
#                   -f net9.0-android \
#                   -c Release \
#                   --output '$(Build.ArtifactStagingDirectory)/Android' \
#                   -p:AndroidKeyStore=true \
#                   -p:AndroidSigningKeyStore=myapp.keystore \
#                   -p:AndroidSigningKeyAlias=myapp \
#                   -p:AndroidSigningKeyPass=$(keystore_password) \
#                   -p:AndroidSigningStorePass=$(keystore_password)

#           - task: PublishBuildArtifacts@1
#             displayName: Publish Android app to artifacts
#             inputs:
#               PathtoPublish: '$(Build.ArtifactStagingDirectory)/Android'
#               ArtifactName: 'Android'
